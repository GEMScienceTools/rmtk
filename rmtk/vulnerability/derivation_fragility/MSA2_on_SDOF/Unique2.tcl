source SDOFmodel.tcl;
loadConst -time 0.0
set maxSteps  17365
set dt 0.005

set IDloadTag 400;	# for uniformSupport excitation
set GMfile "gmr.txt" ;
set GMdirection "1";			# ground-motion direction
set GMfact "1"; 
set AccelSeries "Series -dt $dt -filePath $GMfile -factor  $GMfact";		# time series information
pattern UniformExcitation  $IDloadTag  $GMdirection -accel  $AccelSeries  ;	# create Unifform excitation

# create the analysis
constraints Plain
numberer RCM
system BandSPD
test NormDispIncr 1.0e-8 20
algorithm Newton
integrator Newmark 0.5 0.25
analysis Transient;
set ok 0 
set step 1

while {$ok == 0} {
	set ok [analyze 1 $dt]
	# if the analysis fails try initial tangent iteration 
	if {$ok != 0} { 
	    puts "regular newton failed .. lets try an initail stiffness for this step" 
		test NormDispIncr 1.0e-8 20
	    algorithm ModifiedNewton -initial 
	    set ok [analyze 1 0.01000] 
	    if {$ok == 0} {puts "that worked .. back to regular newton"} 
		test NormDispIncr 1.0e-8 20
	    algorithm Newton 
	}
	set step [expr $step+1]
	if {$step > $maxSteps} { 
	    break
	}
} 
wipe all 
