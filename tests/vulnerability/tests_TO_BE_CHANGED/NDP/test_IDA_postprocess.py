# -*- coding: utf-8 -*-
"""
Created on Tue Feb 17 15:43:50 2015

@author: chiaracasotto
"""

import numpy as np
import csv
import os
from rmtk.vulnerability.NDP.IDA_postprocess import IDA_postprocess
import pandas as pd

# INPUTS

cd = os.getcwd()
input1 = cd+'/inputs/IMval.csv'
input2 = cd+'/inputs/EDPval.csv'
input3 = cd+'/inputs/limits.csv'
    
with open(input1, 'rb') as f:
    reader = csv.reader(f)
    IM = [np.array(row,float) for row in reader]
    
EDP = []    
with open(input2, 'rb') as f:
    reader = csv.reader(f)
    for row in reader:
        for i,ele in enumerate(row):
            if ele is '': 
                row[i] = np.Inf
        EDP.append(np.array(row,float))
            
with open(input3, 'rb') as f:
    reader = csv.reader(f)
    newlist = [row for row in reader]
newlist = [ele[1:] for ele in newlist]
limits = np.array(newlist[1::2],float) #limit states [drifts]
bUthd = np.array(newlist[2::2],float)

[Nstripe,Nrec] = np.shape(EDP)

rec_data = [Nstripe,Nrec] 
g = 9.81

# ANALYSES
[log_meanSa, log_stSa, Pex] = IDA_postprocess(IM, EDP, limits[0], bUthd[0], rec_data, g)

# PRINT DATA
data = pd.DataFrame({'1.Sa50':np.exp(log_meanSa),'2.stdev':log_stSa},index = np.arange(len(log_meanSa)))     
data.to_csv('results/StripeFragility.csv',header=True,index=True)

data2 = pd.DataFrame(Pex, index = np.arange(len(Pex)))
data2.to_csv('results/DiscreteFragility.csv',header=False,index=False)