% ------------------- Chiara Casotto - 10 February 2015 -------------------
%
% This script performs a fragility analysis starting using spo2ida tool. 
% This is a test for the RMTK
% -------------------------------------------------------------------------

close all; clc; clear all
addpath('/Users/chiaracasotto/Documents/GEM/RMTK/DimitriosFiles/');
addpath('/Users/chiaracasotto/Documents/GEM/RMTK/DimitriosFiles/spo2ida_allT/');

%% INPUTS
% building parameters
Gamma = 1.292;
T = 1.612;
MC = 25;
g = 9.81;

% Inputs from pushover
vecs = csvread('../fragility_process/inputs/EDPvec-RDvec.csv');
EDPvec{1} = vecs(:,1);
RDvec{1} = vecs(:,2);
EDPvec{2} = [];
RDvec{2} = [];
SPO	=  [0.104435862	0.233993594	0.897709787	0.940278828	2093.9	2093.9	91.43446494]; %d and F
dry = SPO(1);
du = SPO(4);
mc = 2.24;
a = 0.00;
ac = 0.15;
r = 0.043;
mf = 9;

%Inputs from pushover
SPO=[0.104435862,0.233993594,0.897709787,0.940278828, 2093.9,2093.9,91.43446494]; %d and F
dlim	= [0.002, 0.005, 0.01, 0.02, 0.04, 0.06, 0.08;...
    0.046144456, 0.107312842, 0.212491246, 0.473466774, 0.724976013, 0.940278828, 0.940278828];
bUthd = [0. 0.25];
Sa = [];
bSa = [];

%% ANALYSIS
counter = 1;
for edp = 1:length(EDPvec)
    for disp = 1:length(bUthd)
        for i = 1:length(dlim)
            [SaR50,bRSa,SaT50,bTSa]=SPO2IDAfragility(dry,dlim(edp,i),...
                bUthd(disp),mc,a,ac,r,mf,T,Gamma,EDPvec{edp},RDvec{edp},g,MC);          
            SaT(counter,i) = SaT50;
            b(counter,i) = bTSa;
        end
        counter = counter+1;
    end
end

xlswrite(horzcat('./results/SPO2IDA_fragility_matlab.xls'),[SaT; b])
