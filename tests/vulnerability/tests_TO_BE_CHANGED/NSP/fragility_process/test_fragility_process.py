# -*- coding: utf-8 -*-
"""
Created on Fri Jan 23 11:24:59 2015

@author: chiaracasotto
"""

# Clear existing variables
def clearall():
    all = [var for var in globals() if var[0] != "_"]
    for var in all:
        del globals()[var]
clearall()

# Import functions
import matplotlib.pyplot as plt
import numpy as np
import os
import csv
from rmtk.vulnerability.NSP.fragility_process import fragility_process
from rmtk.vulnerability.common.conversions import from_mean_to_median
import pandas as pd

pi = 3.141592653589793
plt.close("all")
cd = os.getcwd()

# <codecell>

cd = os.getcwd()
noBlg = 5;
Gamma = [1,	1,	1,	1,	1];
T = [1.0037,	0.77964,	0.74098,	0.63234,	0.48996];
Tav = 0.696;
w = [0.1, 0.2, 0.3, 0.3, 0.1];
Sa_ratios = [ 1.6391934,   1.22582094,  1.11783742,  0.92913515,  0.72870817];
SPO = [[0.099,	0.206,	0.25,	0.25,	91.431,	91.431,	84.659],
    [0.061,	0.147,	0.29,	0.25,	63.103,	63.103,	54.743],
    [0.067,	0.130,	0.20,	0.30,	54.735,	54.735,	45.919],
    [0.065,	0.184,	0.27,	0.27,	141.68,	141.68,	120.290],
    [0.082,	0.206,	0.3,	0.3,	111.26,	111.26,	108.06]];
Tc = 0.5;
Td = 1.8;

dcroof = [[0.046144456, 0.107312842, 0.212491246, 0.473466774, 0.724976013, 0.940278828, 0.940278828]]*noBlg 
EDPlim	= [[0.002, 0.005, 0.01, 0.02, 0.04, 0.06, 0.08]]*noBlg

with open(cd+'/inputs/EDPvec-RDvec.csv', 'rb') as f:
    reader = csv.reader(f)
    newlist = [row for row in reader]
EDPvec = [np.array([float(ele[0]) for ele in newlist])]*noBlg
RDvec = [np.array([float(ele[1]) for ele in newlist])]*noBlg

bUthd = [np.repeat(0.,len(dcroof[0]))]*noBlg

# <codecell>

an_type = 2
in_type = 0
vuln = 0
g = 9.81
iml = np.linspace(0.1,2,50)
plotflag = [1, 1, 1, 1]
linew = 2
fontsize = 10
units = ['[m]', '[kN]', '[g]']
N = 10
MC = 50
Tc = 0.5
Td = 1.8
st = (1./(2.*MC))
en = (1.-(1./(2.*MC)))
xp = np.linspace(st,en,MC)
plot_feature = [plotflag, linew, fontsize, units, iml]

# <codecell>

[log_meanSa, log_stSa] = fragility_process(an_type, T, Gamma, w, EDPlim, dcroof, EDPvec, RDvec, SPO, bUthd, noBlg, g, MC, Sa_ratios, plot_feature, N, Tc, Td)

# <codecell> 

data = pd.DataFrame({'1.Sa50':np.exp(log_meanSa),'2.stdev':log_stSa},index = np.arange(len(log_meanSa)))     
data.to_csv('results/fragility_process.csv',header=True,index=True)
