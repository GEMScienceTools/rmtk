# -*- coding: utf-8 -*-
"""
Created on Tue Feb 10 11:33:27 2015

@author: chiaracasotto
"""

# Clear existing variables
def clearall():
    all = [var for var in globals() if var[0] != "_"]
    for var in all:
        del globals()[var]
clearall()
import pandas as pd
import numpy as np
import os
import csv
from rmtk.vulnerability.NSP.vulnerability_process import vulnerability_process
cd = os.getcwd()
pi = 3.141592653589793

# <codecell>

g=9.81
iml = np.linspace(0.001,3.5,25)

plotflag = [0, 0, 1, 1]
linew = 2
fontsize = 10
units = ['[m]', '[kN]', '[g]']
N = 10
MC = 25
plot_feature = [plotflag, linew, fontsize, units, iml]

Gamma = [1.292]
T = [1.612]
Tav = [1.612]
Sa_ratios = [1]
SPO=[[0.104435862,0.233993594,0.897709787,0.940278828, 2093.9,2093.9,91.43446494]];
dcroof = [[0.046144456, 0.107312842, 0.212491246, 0.473466774, 0.724976013, 0.940278828, 0.940278828]]
EDPlim = [[0.002, 0.005, 0.01, 0.02, 0.04, 0.06, 0.08],dcroof[0]]

with open(cd+'/inputs/EDPvec-RDvec.csv', 'rb') as f:
    reader = csv.reader(f)
    newlist = [row for row in reader]
EDPvec = [np.array([float(ele[0]) for ele in newlist]),[0, 1000]]
RDvec = [np.array([float(ele[1]) for ele in newlist]),[0, 1000]]
noBlg = 1
w = [1]
dispersion = [np.repeat(0.,len(dcroof[0])), np.repeat(0.25,len(dcroof[0]))]

Tc=0.5
Td=1.8
mc = 2.24
r = 0.04

data = pd.DataFrame(data={'iml':iml},index=np.arange(len(iml)))
analysis = np.arange(0,3,1)
analysis_name = ['RGM','SPO2IDA','DF']

# <codecell>
for an_type in analysis:
    for k in range(0,len(EDPvec)):
        for j in range(0,len(dispersion)):
            bUthd = [dispersion[j]]*noBlg
            [LR50, bLR] = vulnerability_process(an_type, T, Gamma, w, EDPlim, dcroof, EDPvec, RDvec, SPO, bUthd, noBlg, g, MC, Sa_ratios, plot_feature, N, Tc, Td)
            data['LR50-EdpRd'+str(k)+'-beta'+str(j)] = pd.DataFrame(LR50)
            data['bLR-EdpRd'+str(k)+'-beta'+str(j)] = pd.DataFrame(bLR)
    data.to_csv('results/'+str(analysis_name[an_type])+'_vulnerability.csv',header=True,index=True)

# <codecell>
