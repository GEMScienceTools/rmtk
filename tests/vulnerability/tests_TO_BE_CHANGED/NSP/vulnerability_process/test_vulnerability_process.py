# -*- coding: utf-8 -*-
# <nbformat>3.0</nbformat>

# <codecell>

def clearall():
    all = [var for var in globals() if var[0] != "_"]
    for var in all:
        del globals()[var]
clearall()

import numpy as np
import os
import csv
import pandas as pd
from rmtk.vulnerability.NSP.vulnerability_process import vulnerability_process

# <codecell>

cd = os.getcwd()
noBlg = 5;
Gamma = [1,	1,	1,	1,	1];
T = [1.0037,	0.77964,	0.74098,	0.63234,	0.48996];
Tav = 0.696;
w = [0.1, 0.2, 0.3, 0.3, 0.1];
Sa_ratios = [ 1.6391934,   1.22582094,  1.11783742,  0.92913515,  0.72870817];
SPO = [[0.099,	0.206,	0.25,	0.25,	91.431,	91.431,	84.659],
    [0.061,	0.147,	0.29,	0.25,	63.103,	63.103,	54.743],
    [0.067,	0.130,	0.20,	0.30,	54.735,	54.735,	45.919],
    [0.065,	0.184,	0.27,	0.27,	141.68,	141.68,	120.290],
    [0.082,	0.206,	0.3,	0.3,	111.26,	111.26,	108.06]];
mc = [2.084909223,	2.423581556,	1.956319743,	2.830657081,	2.520028965];
a = [0,	0,	0,	0,	0];
ac = [0.078258456,	0.052634904,	0.063318462,	0.084335985,	0.024990005];
r = [0.925933217,	0.867518185,	0.838933041,	0.849025974,	0.94];
mf = [3.031347296,	4.940577053,	4.500079544,	4.620806632,	3.670947477];
Tc = 0.5;
Td = 1.8;

dcroof = [[0.046144456, 0.107312842, 0.212491246, 0.473466774, 0.724976013, 0.940278828, 0.940278828]]*noBlg 
EDPlim	= [[0.002, 0.005, 0.01, 0.02, 0.04, 0.06, 0.08]]*noBlg

with open(cd+'/inputs/EDPvec-RDvec.csv', 'rb') as f:
    reader = csv.reader(f)
    newlist = [row for row in reader]
EDPvec = [np.array([float(ele[0]) for ele in newlist])]*noBlg
RDvec = [np.array([float(ele[1]) for ele in newlist])]*noBlg

bUthd = [np.repeat(0.25,len(dcroof[0]))]*noBlg

# <codecell>

an_type = 2
in_type = 0
vuln = 1
g = 9.81
iml = np.linspace(0.1,2,50)
plotflag = [0, 0, 0, 0]
linew = 2
fontsize = 10
units = ['[m]', '[kN]', '[g]']
N = 10
MC = 50
Tc = 0.5
Td = 1.8
st = (1./(2.*MC))
en = (1.-(1./(2.*MC)))
xp = np.linspace(st,en,MC)
plot_feature = [plotflag, linew, fontsize, units, iml]

# <codecell>

[LR50, bLR] = vulnerability_process(an_type, T, Gamma, w, EDPlim, dcroof, EDPvec, RDvec, SPO, bUthd, noBlg, g, MC, Sa_ratios, plot_feature, N, Tc, Td)

# <codecell>
data = pd.DataFrame(columns=['iml','meanLR','betaLR'])
data.iml = iml; data.meanLR = LR50; data.betaLR = bLR;
data.to_csv('results/vulnerability_process.csv',header=True,index=False)

# <codecell>


